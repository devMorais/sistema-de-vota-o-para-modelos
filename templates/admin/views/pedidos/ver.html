{% extends "dashboard.html" %}

{% block conteudo %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{url('admin/dashboard')}}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{{url('admin/pedidos/listar')}}">Pedidos</a></li>
        <li class="breadcrumb-item active">Detalhes #{{ pedido.id }}</li>
    </ol>
</nav>

<div class="row">
    <div class="col-md-6">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white fw-bold">
                <i class="fa-solid fa-file-invoice-dollar me-1"></i> Dados do Pagamento
            </div>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Status:</span>
                        {% if pedido.status == 'PAGO' %}
                        <span class="badge bg-success">PAGO</span>
                        {% elseif pedido.status == 'AGUARDANDO' %}
                        <span class="badge bg-warning text-dark">AGUARDANDO</span>
                        {% else %}
                        <span class="badge bg-danger">{{ pedido.status }}</span>
                        {% endif %}
                    </li>
                    <li class="list-group-item d-flex justify-content-between">
                        <span>Total Pago:</span>
                        <span class="fw-bold">R$ {{ formatarValor(pedido.valor_total) }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between text-muted small">
                        <span>Subtotal (Bruto):</span>
                        <span>R$ {{ formatarValor(pedido.valor_subtotal) }}</span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between text-muted small">
                        <span>Taxa Gateway:</span>
                        <span>- R$ {{ formatarValor(pedido.valor_taxa) }}</span>
                    </li>
                    <li class="list-group-item mt-3">
                        <small class="text-muted d-block">ID Transação Asaas:</small>
                        <code>{{ pedido.asaas_id }}</code>
                    </li>

                    {% if pedido.status == 'AGUARDANDO' and pedido.pix_qrcode %}
                    <li class="list-group-item mt-3 text-center bg-light rounded">
                        <small class="text-muted d-block mb-2">Recuperar Pagamento para o Cliente</small>
                        <div class="input-group input-group-sm">
                            <input type="text" class="form-control" value="{{ pedido.pix_qrcode }}" id="pixCodeInput"
                                readonly>
                            <button class="btn btn-outline-dark" type="button" onclick="copiarCodigoPix()">
                                <i class="fa-regular fa-copy"></i> Copiar
                            </button>
                        </div>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-white fw-bold">
                <i class="fa-solid fa-user me-1"></i> Dados do Cliente
            </div>
            <div class="card-body">
                <p class="mb-1"><strong>Nome:</strong> {{ pedido.cliente_nome }}</p>
                <p class="mb-1"><strong>CPF:</strong> {{ pedido.cliente_cpf }}</p>
                <p class="mb-1"><strong>E-mail:</strong> {{ pedido.cliente_email }}</p>
                <p class="mb-1">
                    <strong>Celular:</strong>
                    <a href="https://api.whatsapp.com/send?phone=55{{ pedido.cliente_telefone }}" target="_blank"
                        class="text-decoration-none text-success">
                        <i class="fa-brands fa-whatsapp"></i> {{ pedido.cliente_telefone }}
                    </a>
                </p>
                <p class="mb-0"><strong>Data:</strong> {{ pedido.cadastrado_em|date('d/m/Y H:i') }}</p>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-header bg-white fw-bold">
                <i class="fa-solid fa-star me-1"></i> Item Comprado
            </div>

            {% if candidata %}
            <a href="{{ url('post/' ~ candidata.categoria.slug ~ '/' ~ candidata.slug) }}" target="_blank"
                class="text-decoration-none text-dark">
                <div class="card-body d-flex align-items-center gap-3 hover-bg-light transition">

                    <div style="width: 80px; height: 80px; flex-shrink: 0;">
                        {% if candidata.capa %}
                        <img src="{{ url('uploads/imagens/thumbs/'~candidata.capa) }}" alt="{{ candidata.titulo }}"
                            class="rounded-circle border" style="width: 100%; height: 100%; object-fit: cover;">
                        {% else %}
                        <div class="bg-light d-flex align-items-center justify-content-center rounded-circle border"
                            style="width: 100%; height: 100%;">
                            <i class="fa-solid fa-user text-secondary fs-3"></i>
                        </div>
                        {% endif %}
                    </div>

                    <div>
                        <h5 class="mb-1 fw-bold">
                            {{ candidata.titulo }}
                            <small class="text-muted ms-1"><i class="fa-solid fa-external-link-alt fa-xs"></i></small>
                        </h5>
                        <span class="badge bg-primary rounded-pill px-3 py-2">{{ pedido.total_votos }} Votos</span>
                    </div>
                </div>
            </a>
            {% else %}
            <div class="card-body text-muted">
                <i class="fa-solid fa-ban me-2"></i> Candidata não encontrada ou excluída.
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function copiarCodigoPix() {
        var copyText = document.getElementById("pixCodeInput");
        copyText.select();
        copyText.setSelectionRange(0, 99999); // Mobile
        navigator.clipboard.writeText(copyText.value);

        // Usa o seu sistema de notificação (jBox ou alert)
        if (typeof jBox !== 'undefined') {
            new jBox('Notice', { content: 'Código PIX copiado!', color: 'green' });
        } else {
            alert("Código PIX copiado!");
        }
    }
</script>
{% endblock %}